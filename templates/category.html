<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8"> 
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<!-- Latest compiled and minified CSS -->
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
	<!-- jQuery library -->
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
	<!-- Popper JS -->
	<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
	<!-- Latest compiled JavaScript -->
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>

	<!--<script src="helper.js"></script>-->
	<!--<script type="text/javascript" src="{{ url_for('static', filename='cart.js') }}"></script>-->

	<!-- personal style sheet -->
	<link rel= "stylesheet" type= "text/css" href= "{{ url_for('static',filename='styles/styles.css') }}">
	<link rel="stylesheet" href="css/bootstrap-responsive.css">

	<!-- fontawesome -->
	<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.1/css/all.css" integrity="sha384-50oBUHEmvpQ+1lW4y57PTFmhCaXp0ML5d60M1M7uH2+nqUivzIebhndOJK28anvf" crossorigin="anonymous">
<script>
	if (document.readyState == 'loading') {
    document.addEventListener('DOMContentLoaded', ready)
} else {
    ready()
}

function ready() {
    var removeCartItemButtons = document.getElementsByClassName('btn-danger')
    for (var i = 0; i < removeCartItemButtons.length; i++) {
        var button = removeCartItemButtons[i]
        button.addEventListener('click', removeCartItem)
    }

    var addToCartButtons = document.getElementsByClassName('shop-item-button')
    for (var i = 0; i < addToCartButtons.length; i++) {
        var button = addToCartButtons[i]
        button.addEventListener('click', addToCartClicked)
    }

    document.getElementsByClassName('btn-purchase')[0].addEventListener('click', purchaseClicked)
}

function purchaseClicked() {
    alert('Items Cleared')
    var cartItems = document.getElementsByClassName('cart-items')[0]
    while (cartItems.hasChildNodes()) {
        cartItems.removeChild(cartItems.firstChild)
    }
    updateCartTotal()
}

function removeCartItem(event) {
    var buttonClicked = event.target
    buttonClicked.parentElement.parentElement.remove()
    updateCartTotal()
}

function addToCartClicked(event) {

    var button = event.target
    var shopItem = button.parentElement.parentElement
    var title = shopItem.getElementsByClassName('shop-item-title')[0].innerText
    var price = shopItem.getElementsByClassName('shop-item-price')[0].innerText
  
    addItemToCart(title, price)
    updateCartTotal()
}

function addItemToCart(title, price) {
    var cartBlock = document.createElement('div')
    cartBlock.classList.add('cart-block')
    var cartItems = document.getElementsByClassName('cart-items')[0]
    var cartItemNames = cartItems.getElementsByClassName('cart-item-title')
  
    var cartBlockContents = `
    <div class = "cart-item">
    <span class="cart-item-title">${title}</span>
    <span class="cart-price">${price}</span>
    
     <button class="btn btn-danger fas fa-minus" type="button"></button>
    </div>
      
        `
    cartBlock.innerHTML = cartBlockContents
    cartItems.append(cartBlock)
    cartBlock.getElementsByClassName('btn-danger')[0].addEventListener('click', removeCartItem)
    
}

function updateCartTotal() {
    var cartItemContainer = document.getElementsByClassName('cart-items')[0]
    var cartBlocks = cartItemContainer.getElementsByClassName('cart-block')
    var total = 0
    var maxPrice = 0
    for (var i = 0; i < cartBlocks.length; i++) {
        var cartBlock = cartBlocks[i]
        var priceElement = cartBlock.getElementsByClassName('cart-price')[0]
        var price = parseFloat(priceElement.innerText.replace('$', ''))
        total = total + price
    }
    total = Math.round(total * 100) / 100
    
    if (getTime() == 0) {
        maxPrice = 6
    }
    else {
        maxPrice = 7
    }
    // COLOR FOR TOTAL WHEN IT BECOMES GREATER THAN LATEMEAL PRICE
    if (total <= maxPrice) {
    	document.getElementsByClassName('cart-total-price')[0].style.color = "green";
        document.getElementsByClassName('cart-dif')[0].innerText = '';
    }
    if (total > maxPrice) {
    	document.getElementsByClassName('cart-total-price')[0].style.color = "red";
        document.getElementsByClassName('cart-dif')[0].innerText = '- $' + (total - maxPrice).toFixed(2);
        document.getElementsByClassName('cart-dif')[0].style.color = "red";
    }
    document.getElementsByClassName('cart-total-price')[0].innerText = '$' + total.toFixed(2)


}

/* return 0 for lunchtime, 1 for dinner */
function getTime() {
    var time = new Date()
    if (time.getHours() * 60 + time.getMinutes() <= 945) { // lunch time
        return 0
    }
    else { // dinner time
        return 1
    }
}
	</script>
	
	
<style>
	table {
 		width: 100%;
		align: left;
	}		

	td, th {
  		text-align: left;
		padding: 15px;
		align: left;
	}
	
	tr:nth-child(even) {
 	 	background-color: #dddddd;
	}

</style>
</head>

<title>CalcuLateMeal</title>

<body>
	<header class="container-fluid fixed-top">
		<nav class="navbar navbar-expand-lg navbar-dark bg-dark fixed-top" style="padding-right: 5vw; padding-left: 5vw;">
			<div class="container-fluid">
				<a class="navbar-brand" href="/">CalcuLateMeal</a>
				<button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation">
					<span class="navbar-toggler-icon"></span>
				</button>
				<div class="collapse navbar-collapse" id="navbarResponsive">
					<ul class="navbar-nav ml-auto">
						<li class="nav-item">
							<a class="nav-link" href="/">Home
								<span class="sr-only">(current)</span>
							</a>
						</li>
						<li class="nav-item">
							<a class="nav-link" href="/info">About</a>
						</li>
						<li class="nav-item">
							<a class="nav-link" href="/favorites">Favorites</a>
						</li>
						<!--<li class="nav-item">
							<a class="nav-link" href="contact">Contact</a>
						</li>-->
					</ul>
				</div>
			</div>
		</nav>
		
			<form class="searchbutton" style = "position: absolute; width: 100%; left: 0; background-color: #fafafa;" action="action_page.php">
				<div class = "row padding-0" style="padding-top:2rem;">

					<div class = "col-1 "></div>
					<div class = "col-9 padding-0">   	
						<div class="searchbar">
							<input type="text" id="itemsearch" class="form-control" placeholder="Search...">
						</div>
					</div>
					<div class = "col-1 " style="display: inline-block; padding-top: 2rem; padding-left: 0rem; padding-right:1rem;">
						<button type="submit" onclick="return handleSearchItem();"><i class="fa fa-search"></i></button>
					</div>
				</div>
				
			</form>
		

	</header>
	
	<!-- submission functions -->
	<script>
		function handleSearchItem() {
			var query = document.getElementById('itemsearch').value;
			window.location.href = "/search/item/" + query;
			return false;
		}
	</script>


	<section class="page-container" >

	<!-- display results !-->
	{% if resultList %}
		
			<script>handleResults(resultList);</script>
		<h5>
			
				<table class="shop-items" id="shop-items">
					{{ resultList }}
				</table>
			
		</h5>
	{% else %}
  		<h1>No results found.</h1>
	{% endif %}

   	
	</section>

	<script>
		function handleResults(resultList) {
			text = "";
			for (var i = 0; i < resultList.length; i++) {
				text = text + resultList[i];
			}
			document.getElementById("shop-items").innerHTML = text;
		}
	</script>

<div>
					<input type="checkbox" name="lunchcheck" id="lunchcheck">Lunch<br>
					<input type="checkbox" name="dinnercheck" id="dinnercheck">Dinner<br>
				</div>
				
				<script>
				    if (!getTime()) { // lunch time
					document.getElementById("lunchcheck").checked = true;
				    }
				    else { // dinner time
					document.getElementById("dinnercheck").checked = true;
				    }
				</script>

<!-- calculator -->
<footer>
	<div class = "row fixed-bottom" style = "background-color: #eceff1;border-top: solid #3E4551 .1rem;max-height:210px; overflow:auto;"> 
		<div class = "col-9 " style = "padding-right:0; padding-top:.8rem; border-right: solid .1rem; text-align: center;" >
			<h6>YOUR CART</h6>
			<div class="calculator-scroll">				
				<div class="cart-items"></div>
			</div>
		</div>


		<div class = "col-3" style = "padding-left:0; text-align: center; padding-top: .8rem;">
			<h6>TOTAL</h6>
			<div class = "cart-total-price">$0.00</div>
			<div class = "cart-dif"></div>
		</div>
	</div>
</footer>


<!-- shopping cart-->

</body>
</html>
